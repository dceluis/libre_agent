<!-- wui/templates/chat.html -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>LibreAgent Chat</title>
    <link href="/static/styles.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx-ext-ws@2.0.1/ws.js"></script>
  </head>
  <body>
    <div class="chat-container">
      <h1>LibreAgent Chat</h1>

      <div id="chat-box" class="chat-box" hx-ext="ws" ws-connect="/ws">
        {% for message in messages %}
          {% include 'message.html' %}
        {% endfor %}
      </div>
      <form hx-post="/send_message" hx-target="#chat-box" hx-swap="beforeend" class="chat-form">
        <input type="text" name="message" placeholder="Type your message here..." required autocomplete="off">
        <button type="submit">Send</button>
      </form>
    </div>

    <!-- Auto-scroll Script -->
    <script>
    // Function to scroll the chat box to the bottom
    function scrollToBottom() {
      const chatBox = document.getElementById('chat-box');

      chatBox.scrollTo({
        top: chatBox.scrollHeight,
        behavior: 'smooth'
      });
    }

    window.onload = scrollToBottom;

    document.body.addEventListener('htmx:afterSwap', function(event) {
      if (event.target.id === 'chat-box') {
        scrollToBottom();
      }
    });
    document.body.addEventListener('htmx:oobAfterSwap', function(event) {
      console.log(event.target)
      if (event.target.id === 'chat-box') {
        scrollToBottom();
      }
    });


    </script>
  </body>
</html>
